import{B as Fe}from"./index-Ch16bZ1C.js";/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const jt="[object ArrayBuffer]";class g{static isArrayBuffer(e){return Object.prototype.toString.call(e)===jt}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const i=g.toUint8Array(e),r=g.toUint8Array(t);if(i.length!==r.byteLength)return!1;for(let n=0;n<i.length;n++)if(i[n]!==r[n])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let i=0;for(const o of t)i+=o.byteLength;const r=new Uint8Array(i);let n=0;for(const o of t){const a=this.toUint8Array(o);r.set(a,n),n+=a.length}return e[e.length-1]instanceof Function?this.toView(r,e[e.length-1]):r.buffer}}const be="string",Gt=/^[0-9a-f\s]+$/i,Jt=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Wt=/^[a-zA-Z0-9-_]+$/;class _e{static fromString(e){const t=unescape(encodeURIComponent(e)),i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i.buffer}static toString(e){const t=g.toUint8Array(e);let i="";for(let n=0;n<t.length;n++)i+=String.fromCharCode(t[n]);return decodeURIComponent(escape(i))}}class V{static toString(e,t=!1){const i=g.toArrayBuffer(e),r=new DataView(i);let n="";for(let o=0;o<i.byteLength;o+=2){const a=r.getUint16(o,t);n+=String.fromCharCode(a)}return n}static fromString(e,t=!1){const i=new ArrayBuffer(e.length*2),r=new DataView(i);for(let n=0;n<e.length;n++)r.setUint16(n*2,e.charCodeAt(n),t);return i}}class B{static isHex(e){return typeof e===be&&Gt.test(e)}static isBase64(e){return typeof e===be&&Jt.test(e)}static isBase64Url(e){return typeof e===be&&Wt.test(e)}static ToString(e,t="utf8"){const i=g.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(i);case"binary":return this.ToBinary(i);case"hex":return this.ToHex(i);case"base64":return this.ToBase64(i);case"base64url":return this.ToBase64Url(i);case"utf16le":return V.toString(i,!0);case"utf16":case"utf16be":return V.toString(i);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return V.fromString(e,!0);case"utf16":case"utf16be":return V.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=g.toUint8Array(e);if(typeof btoa<"u"){const i=this.ToString(t,"binary");return btoa(i)}else return Fe.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!B.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Fe.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!B.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=B.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return _e.fromString(e);case"utf16":case"utf16be":return V.fromString(e);case"utf16le":case"usc2":return V.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=B.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return _e.toString(e);case"utf16":case"utf16be":return V.toString(e);case"utf16le":case"usc2":return V.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,i=new Uint8Array(t);for(let r=0;r<t;r++)i[r]=e.charCodeAt(r);return i.buffer}static ToBinary(e){const t=g.toUint8Array(e);let i="";for(let r=0;r<t.length;r++)i+=String.fromCharCode(t[r]);return i}static ToHex(e){const t=g.toUint8Array(e);let i="";const r=t.length;for(let n=0;n<r;n++){const o=t[n];o<16&&(i+="0"),i+=o.toString(16)}return i}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!B.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const i=new Uint8Array(t.length/2);for(let r=0;r<t.length;r=r+2){const n=t.slice(r,r+2);i[r/2]=parseInt(n,16)}return i.buffer}static ToUtf16String(e,t=!1){return V.toString(e,t)}static FromUtf16String(e,t=!1){return V.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let i=0;i<t;i++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}B.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function $(s,e){let t=0;if(s.length===1)return s[0];for(let i=s.length-1;i>=0;i--)t+=s[s.length-1-i]*Math.pow(2,e*i);return t}function F(s,e,t=-1){const i=t;let r=s,n=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(s<o){let l;if(i<0)l=new ArrayBuffer(a),n=a;else{if(i<a)return new ArrayBuffer(0);l=new ArrayBuffer(i),n=i}const c=new Uint8Array(l);for(let h=a-1;h>=0;h--){const u=Math.pow(2,h*e);c[n-h-1]=Math.floor(r/u),r-=c[n-h-1]*u}return l}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function Ae(...s){let e=0,t=0;for(const n of s)e+=n.length;const i=new ArrayBuffer(e),r=new Uint8Array(i);for(const n of s)r.set(n,t),t+=n.length;return r}function Ge(){const s=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=s[0]===255&&s[1]&128,l=s[0]===0&&(s[1]&128)===0;(a||l)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=s[0]&128;const i=$(t,8),r=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(r);for(let a=0;a<this.valueHex.byteLength;a++)n[a]=s[a];return n[0]&=127,$(n,8)-i}function Zt(s){const e=s<0?s*-1:s;let t=128;for(let i=1;i<8;i++){if(e<=t){if(s<0){const o=t-e,a=F(o,8,i),l=new Uint8Array(a);return l[0]|=128,a}let r=F(e,8,i),n=new Uint8Array(r);if(n[0]&128){const o=r.slice(0),a=new Uint8Array(o);r=new ArrayBuffer(r.byteLength+1),n=new Uint8Array(r);for(let l=0;l<o.byteLength;l++)n[l+1]=a[l];n[0]=0}return r}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function qt(s,e){if(s.byteLength!==e.byteLength)return!1;const t=new Uint8Array(s),i=new Uint8Array(e);for(let r=0;r<t.length;r++)if(t[r]!==i[r])return!1;return!0}function A(s,e){const t=s.toString(10);if(e<t.length)return"";const i=e-t.length,r=new Array(i);for(let o=0;o<i;o++)r[o]="0";return r.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function P(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Ne(s){let e=0,t=0;for(let r=0;r<s.length;r++){const n=s[r];e+=n.byteLength}const i=new Uint8Array(e);for(let r=0;r<s.length;r++){const n=s[r];i.set(new Uint8Array(n),t),t+=n.byteLength}return i.buffer}function I(s,e,t,i){return e instanceof Uint8Array?e.byteLength?t<0?(s.error="Wrong parameter: inputOffset less than zero",!1):i<0?(s.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-i<0?(s.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(s.error="Wrong parameter: inputBuffer has zero length",!1):(s.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class te{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Ne(this.items)}}const W=[new Uint8Array([1])],De="0123456789",ye="name",$e="valueHexView",zt="isHexOnly",Yt="idBlock",Xt="tagClass",Qt="tagNumber",Kt="isConstructed",Pt="fromBER",er="toBER",tr="local",b="",E=new ArrayBuffer(0),re=new Uint8Array(0),z="EndOfContent",Je="OCTET STRING",We="BIT STRING";function U(s){var e;return e=class extends s{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(i){this.valueHexView=new Uint8Array(i)}constructor(...i){var r;super(...i);const n=i[0]||{};this.isHexOnly=(r=n.isHexOnly)!==null&&r!==void 0?r:!1,this.valueHexView=n.valueHex?g.toUint8Array(n.valueHex):re}fromBER(i,r,n){const o=i instanceof ArrayBuffer?new Uint8Array(i):i;if(!I(this,o,r,n))return-1;const a=r+n;return this.valueHexView=o.subarray(r,a),this.valueHexView.length?(this.blockLength=n,a):(this.warnings.push("Zero buffer length"),r)}toBER(i=!1){return this.isHexOnly?i?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",E)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:B.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class D{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=b,warnings:i=[],valueBeforeDecode:r=re}={}){this.blockLength=e,this.error=t,this.warnings=i,this.valueBeforeDecodeView=g.toUint8Array(r)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:B.ToHex(this.valueBeforeDecodeView)}}}D.NAME="baseBlock";class m extends D{fromBER(e,t,i){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}m.NAME="valueBlock";class Ze extends U(D){constructor({idBlock:e={}}={}){var t,i,r,n;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?g.toUint8Array(e.valueHex):re,this.tagClass=(i=e.tagClass)!==null&&i!==void 0?i:-1,this.tagNumber=(r=e.tagNumber)!==null&&r!==void 0?r:-1,this.isConstructed=(n=e.isConstructed)!==null&&n!==void 0?n:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",E}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const r=new Uint8Array(1);if(!e){let n=this.tagNumber;n&=31,t|=n,r[0]=t}return r.buffer}if(!this.isHexOnly){const r=F(this.tagNumber,7),n=new Uint8Array(r),o=r.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let l=0;l<o-1;l++)a[l+1]=n[l]|128;a[o]=n[o-1]}return a.buffer}const i=new Uint8Array(this.valueHexView.byteLength+1);if(i[0]=t|31,!e){const r=this.valueHexView;for(let n=0;n<r.length-1;n++)i[n+1]=r[n]|128;i[this.valueHexView.byteLength]=r[r.length-1]}return i.buffer}fromBER(e,t,i){const r=g.toUint8Array(e);if(!I(this,r,t,i))return-1;const n=r.subarray(t,t+i);if(n.length===0)return this.error="Zero buffer length",-1;switch(n[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(n[0]&32)===32,this.isHexOnly=!1;const a=n[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let l=1,c=this.valueHexView=new Uint8Array(255),h=255;for(;n[l]&128;){if(c[l-1]=n[l]&127,l++,l>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(l===h){h+=255;const v=new Uint8Array(h);for(let w=0;w<c.length;w++)v[w]=c[w];c=this.valueHexView=new Uint8Array(h)}}this.blockLength=l+1,c[l-1]=n[l]&127;const u=new Uint8Array(l);for(let v=0;v<l;v++)u[v]=c[v];c=this.valueHexView=new Uint8Array(l),c.set(u),this.blockLength<=9?this.tagNumber=$(c,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}Ze.NAME="identificationBlock";class qe extends D{constructor({lenBlock:e={}}={}){var t,i,r;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(i=e.longFormUsed)!==null&&i!==void 0?i:!1,this.length=(r=e.length)!==null&&r!==void 0?r:0}fromBER(e,t,i){const r=g.toUint8Array(e);if(!I(this,r,t,i))return-1;const n=r.subarray(t,t+i);if(n.length===0)return this.error="Zero buffer length",-1;if(n[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=n[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(n[0]&128),this.longFormUsed===!1)return this.length=n[0],this.blockLength=1,t+this.blockLength;const o=n[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>n.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,l=r.subarray(a,a+o);return l[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=$(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,i;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(i=new Uint8Array(t),i[0]=128),t;if(this.longFormUsed){const r=F(this.length,8);if(r.byteLength>127)return this.error="Too big length",E;if(t=new ArrayBuffer(r.byteLength+1),e)return t;const n=new Uint8Array(r);i=new Uint8Array(t),i[0]=r.byteLength|128;for(let o=0;o<r.byteLength;o++)i[o+1]=n[o];return t}return t=new ArrayBuffer(1),e===!1&&(i=new Uint8Array(t),i[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}qe.NAME="lengthBlock";const f={};class k extends D{constructor({name:e=b,optional:t=!1,primitiveSchema:i,...r}={},n){super(r),this.name=e,this.optional=t,i&&(this.primitiveSchema=i),this.idBlock=new Ze(r),this.lenBlock=new qe(r),this.valueBlock=n?new n(r):new m(r)}fromBER(e,t,i){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return r===-1?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}toBER(e,t){const i=t||new te;t||ze(this);const r=this.idBlock.toBER(e);if(i.write(r),this.lenBlock.isIndefiniteForm)i.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,i),i.write(new ArrayBuffer(2));else{const n=this.valueBlock.toBER(e);this.lenBlock.length=n.byteLength;const o=this.lenBlock.toBER(e);i.write(o),i.write(n)}return t?E:i.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():B.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=B.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),i=e.toBER();return qt(t,i)}}k.NAME="BaseBlock";function ze(s){var e;if(s instanceof f.Constructed)for(const t of s.valueBlock.value)ze(t)&&(s.lenBlock.isIndefiniteForm=!0);return!!(!((e=s.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class Ee extends k{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=b,...t}={},i){super(t,i),e&&this.fromString(e)}fromBER(e,t,i){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return r===-1?(this.error=this.valueBlock.error,r):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}Ee.NAME="BaseStringBlock";class Ye extends U(m){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}Ye.NAME="PrimitiveValueBlock";var Xe;class ie extends k{constructor(e={}){super(e,Ye),this.idBlock.isConstructed=!1}}Xe=ie;f.Primitive=Xe;ie.NAME="PRIMITIVE";function rr(s,e){if(s instanceof e)return s;const t=new e;return t.idBlock=s.idBlock,t.lenBlock=s.lenBlock,t.warnings=s.warnings,t.valueBeforeDecodeView=s.valueBeforeDecodeView,t}function J(s,e=0,t=s.length){const i=e;let r=new k({},m);const n=new D;if(!I(n,s,e,t))return r.error=n.error,{offset:-1,result:r};if(!s.subarray(e,e+t).length)return r.error="Zero buffer length",{offset:-1,result:r};let a=r.idBlock.fromBER(s,e,t);if(r.idBlock.warnings.length&&r.warnings.concat(r.idBlock.warnings),a===-1)return r.error=r.idBlock.error,{offset:-1,result:r};if(e=a,t-=r.idBlock.blockLength,a=r.lenBlock.fromBER(s,e,t),r.lenBlock.warnings.length&&r.warnings.concat(r.lenBlock.warnings),a===-1)return r.error=r.lenBlock.error,{offset:-1,result:r};if(e=a,t-=r.lenBlock.blockLength,!r.idBlock.isConstructed&&r.lenBlock.isIndefiniteForm)return r.error="Indefinite length form used for primitive encoding form",{offset:-1,result:r};let l=k;switch(r.idBlock.tagClass){case 1:if(r.idBlock.tagNumber>=37&&r.idBlock.isHexOnly===!1)return r.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:r};switch(r.idBlock.tagNumber){case 0:if(r.idBlock.isConstructed&&r.lenBlock.length>0)return r.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:r};l=f.EndOfContent;break;case 1:l=f.Boolean;break;case 2:l=f.Integer;break;case 3:l=f.BitString;break;case 4:l=f.OctetString;break;case 5:l=f.Null;break;case 6:l=f.ObjectIdentifier;break;case 10:l=f.Enumerated;break;case 12:l=f.Utf8String;break;case 13:l=f.RelativeObjectIdentifier;break;case 14:l=f.TIME;break;case 15:return r.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:r};case 16:l=f.Sequence;break;case 17:l=f.Set;break;case 18:l=f.NumericString;break;case 19:l=f.PrintableString;break;case 20:l=f.TeletexString;break;case 21:l=f.VideotexString;break;case 22:l=f.IA5String;break;case 23:l=f.UTCTime;break;case 24:l=f.GeneralizedTime;break;case 25:l=f.GraphicString;break;case 26:l=f.VisibleString;break;case 27:l=f.GeneralString;break;case 28:l=f.UniversalString;break;case 29:l=f.CharacterString;break;case 30:l=f.BmpString;break;case 31:l=f.DATE;break;case 32:l=f.TimeOfDay;break;case 33:l=f.DateTime;break;case 34:l=f.Duration;break;default:{const c=r.idBlock.isConstructed?new f.Constructed:new f.Primitive;c.idBlock=r.idBlock,c.lenBlock=r.lenBlock,c.warnings=r.warnings,r=c}}break;case 2:case 3:case 4:default:l=r.idBlock.isConstructed?f.Constructed:f.Primitive}return r=rr(r,l),a=r.fromBER(s,e,r.lenBlock.isIndefiniteForm?t:r.lenBlock.length),r.valueBeforeDecodeView=s.subarray(i,i+r.blockLength),{offset:a,result:r}}function Z(s){if(!s.byteLength){const e=new k({},m);return e.error="Input buffer has zero length",{offset:-1,result:e}}return J(g.toUint8Array(s).slice(),0,s.byteLength)}function ir(s,e){return s?1:e}class R extends m{constructor({value:e=[],isIndefiniteForm:t=!1,...i}={}){super(i),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,i){const r=g.toUint8Array(e);if(!I(this,r,t,i))return-1;if(this.valueBeforeDecodeView=r.subarray(t,t+i),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let n=t;for(;ir(this.isIndefiniteForm,i)>0;){const o=J(r,n,i);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(n=o.offset,this.blockLength+=o.result.blockLength,i-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===z)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===z?this.value.pop():this.warnings.push("No EndOfContent block encoded")),n}toBER(e,t){const i=t||new te;for(let r=0;r<this.value.length;r++)this.value[r].toBER(e,i);return t?E:i.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}R.NAME="ConstructedValueBlock";var Qe;class S extends k{constructor(e={}){super(e,R),this.idBlock.isConstructed=!0}fromBER(e,t,i){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return r===-1?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){const e=[];for(const i of this.valueBlock.value)e.push(i.toString("ascii").split(`
`).map(r=>`  ${r}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}Qe=S;f.Constructed=Qe;S.NAME="CONSTRUCTED";class Ke extends m{fromBER(e,t,i){return t}toBER(e){return E}}Ke.override="EndOfContentValueBlock";var Pe;class Ve extends k{constructor(e={}){super(e,Ke),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}Pe=Ve;f.EndOfContent=Pe;Ve.NAME=z;var et;class p extends k{constructor(e={}){super(e,m),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,i){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=i,t+i>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+i}toBER(e,t){const i=new ArrayBuffer(2);if(!e){const r=new Uint8Array(i);r[0]=5,r[1]=0}return t&&t.write(i),i}onAsciiEncoding(){return`${this.constructor.NAME}`}}et=p;f.Null=et;p.NAME="NULL";class tt extends U(m){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=g.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,i){const r=g.toUint8Array(e);return I(this,r,t,i)?(this.valueHexView=r.subarray(t,t+i),i>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Ge.call(this),this.blockLength=i,t+i):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}tt.NAME="BooleanValueBlock";var rt;class se extends k{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,tt),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}rt=se;f.Boolean=rt;se.NAME="BOOLEAN";class it extends U(R){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,i){let r=0;if(this.isConstructed){if(this.isHexOnly=!1,r=R.prototype.fromBER.call(this,e,t,i),r===-1)return r;for(let n=0;n<this.value.length;n++){const o=this.value[n].constructor.NAME;if(o===z){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==Je)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,r=super.fromBER(e,t,i),this.blockLength=i;return r}toBER(e,t){return this.isConstructed?R.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}it.NAME="OctetStringValueBlock";var Ce;let ne=class extends k{constructor({idBlock:e={},lenBlock:t={},...i}={}){var r,n;(r=i.isConstructed)!==null&&r!==void 0||(i.isConstructed=!!(!((n=i.value)===null||n===void 0)&&n.length)),super({idBlock:{isConstructed:i.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!i.isIndefiniteForm},...i},it),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,i){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,i===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const n=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+i);try{if(n.byteLength){const o=J(n,0,n.byteLength);o.offset!==-1&&o.offset===i&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,i)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return S.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=B.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Ce&&e.push(t.valueBlock.valueHexView);return g.concat(e)}};Ce=ne;f.OctetString=Ce;ne.NAME=Je;class st extends U(R){constructor({unusedBits:e=0,isConstructed:t=!1,...i}={}){super(i),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,i){if(!i)return t;let r=-1;if(this.isConstructed){if(r=R.prototype.fromBER.call(this,e,t,i),r===-1)return r;for(const a of this.value){const l=a.constructor.NAME;if(l===z){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==We)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const c=a.valueBlock;if(this.unusedBits>0&&c.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=c.unusedBits}return r}const n=g.toUint8Array(e);if(!I(this,n,t,i))return-1;const o=n.subarray(t,t+i);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const l=J(a,0,a.byteLength);l.offset!==-1&&l.offset===i-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+i}toBER(e,t){if(this.isConstructed)return R.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return E;const i=new Uint8Array(this.valueHexView.length+1);return i[0]=this.unusedBits,i.set(this.valueHexView,1),i.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}st.NAME="BitStringValueBlock";var nt;let oe=class extends k{constructor({idBlock:e={},lenBlock:t={},...i}={}){var r,n;(r=i.isConstructed)!==null&&r!==void 0||(i.isConstructed=!!(!((n=i.value)===null||n===void 0)&&n.length)),super({idBlock:{isConstructed:i.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!i.isIndefiniteForm},...i},st),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,i){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,i)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return S.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const i=e.join(""),r=this.constructor.NAME,n=i.substring(0,i.length-this.valueBlock.unusedBits);return`${r} : ${n}`}}};nt=oe;f.BitString=nt;oe.NAME=We;var ot;function sr(s,e){const t=new Uint8Array([0]),i=new Uint8Array(s),r=new Uint8Array(e);let n=i.slice(0);const o=n.length-1,a=r.slice(0),l=a.length-1;let c=0;const h=l<o?o:l;let u=0;for(let v=h;v>=0;v--,u++){switch(!0){case u<a.length:c=n[o-u]+a[l-u]+t[0];break;default:c=n[o-u]+t[0]}switch(t[0]=c/10,!0){case u>=n.length:n=Ae(new Uint8Array([c%10]),n);break;default:n[o-u]=c%10}}return t[0]>0&&(n=Ae(t,n)),n}function pe(s){if(s>=W.length)for(let e=W.length;e<=s;e++){const t=new Uint8Array([0]);let i=W[e-1].slice(0);for(let r=i.length-1;r>=0;r--){const n=new Uint8Array([(i[r]<<1)+t[0]]);t[0]=n[0]/10,i[r]=n[0]%10}t[0]>0&&(i=Ae(t,i)),W.push(i)}return W[s]}function nr(s,e){let t=0;const i=new Uint8Array(s),r=new Uint8Array(e),n=i.slice(0),o=n.length-1,a=r.slice(0),l=a.length-1;let c,h=0;for(let u=l;u>=0;u--,h++)switch(c=n[o-h]-a[l-h]-t,!0){case c<0:t=1,n[o-h]=c+10;break;default:t=0,n[o-h]=c}if(t>0)for(let u=o-l+1;u>=0;u--,h++)if(c=n[o-h]-t,c<0)t=1,n[o-h]=c+10;else{t=0,n[o-h]=c;break}return n.slice()}class Ue extends U(m){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Ge.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Zt(e))}get valueDec(){return this._valueDec}fromDER(e,t,i,r=0){const n=this.fromBER(e,t,i);if(n===-1)return n;const o=this.valueHexView;return o[0]===0&&(o[1]&128)!==0?this.valueHexView=o.subarray(1):r!==0&&o.length<r&&(r-o.length>1&&(r=o.length+1),this.valueHexView=o.subarray(r-o.length)),n}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const i=new Uint8Array(this.valueHexView.length+1);i[0]=0,i.set(t,1),this.valueHexView=i}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,i){const r=super.fromBER(e,t,i);return r===-1||this.setValueHex(),r}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),i=0,r;const n=this.valueHexView;let o="",a=!1;for(let l=n.byteLength-1;l>=0;l--){r=n[l];for(let c=0;c<8;c++){if((r&1)===1)switch(i){case e:t=nr(pe(i),t),o="-";break;default:t=sr(t,pe(i))}i++,r>>=1}}for(let l=0;l<t.length;l++)t[l]&&(a=!0),a&&(o+=De.charAt(t[l]));return a===!1&&(o+=De.charAt(0)),o}}ot=Ue;Ue.NAME="IntegerValueBlock";Object.defineProperty(ot.prototype,"valueHex",{set:function(s){this.valueHexView=new Uint8Array(s),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var q;class Y extends k{constructor(e={}){super(e,Ue),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return P(),BigInt(this.valueBlock.toString())}static fromBigInt(e){P();const t=BigInt(e),i=new te,r=t.toString(16).replace(/^-/,""),n=new Uint8Array(B.FromHex(r));if(t<0){const a=new Uint8Array(n.length+(n[0]&128?1:0));a[0]|=128;const c=BigInt(`0x${B.ToHex(a)}`)+t,h=g.toUint8Array(B.FromHex(c.toString(16)));h[0]|=128,i.write(h)}else n[0]&128&&i.write(new Uint8Array([0])),i.write(n);return new q({valueHex:i.final()})}convertToDER(){const e=new q({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new q({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}q=Y;f.Integer=q;Y.NAME="INTEGER";var lt;class le extends Y{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}lt=le;f.Enumerated=lt;le.NAME="ENUMERATED";class xe extends U(m){constructor({valueDec:e=-1,isFirstSid:t=!1,...i}={}){super(i),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,i){if(!i)return t;const r=g.toUint8Array(e);if(!I(this,r,t,i))return-1;const n=r.subarray(t,t+i);this.valueHexView=new Uint8Array(i);for(let a=0;a<i&&(this.valueHexView[a]=n[a]&127,this.blockLength++,(n[a]&128)!==0);a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,(n[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=$(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){P();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const i=new Uint8Array(t.length/7);for(let r=0;r<i.length;r++)i[r]=parseInt(t.slice(r*7,r*7+7),2)+(r+1<i.length?128:0);this.fromBER(i.buffer,0,i.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const r=this.valueHexView,n=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)n[o]=r[o]|128;return n[this.blockLength-1]=r[this.blockLength-1],n.buffer}const t=F(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",E;const i=new Uint8Array(t.byteLength);if(!e){const r=new Uint8Array(t),n=t.byteLength-1;for(let o=0;o<n;o++)i[o]=r[o]|128;i[n]=r[n]}return i}toString(){let e="";if(this.isHexOnly)e=B.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}xe.NAME="sidBlock";class at extends m{constructor({value:e=b,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,i){let r=t;for(;i>0;){const n=new xe;if(r=n.fromBER(e,r,i),r===-1)return this.blockLength=0,this.error=n.error,r;this.value.length===0&&(n.isFirstSid=!0),this.blockLength+=n.blockLength,i-=n.blockLength,this.value.push(n)}return r}toBER(e){const t=[];for(let i=0;i<this.value.length;i++){const r=this.value[i].toBER(e);if(r.byteLength===0)return this.error=this.value[i].error,E;t.push(r)}return Ne(t)}fromString(e){this.value=[];let t=0,i=0,r="",n=!1;do if(i=e.indexOf(".",t),i===-1?r=e.substring(t):r=e.substring(t,i),t=i+1,n){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const l=parseInt(r,10);if(isNaN(l))return;o.valueDec=l+a,n=!1}else{const o=new xe;if(r>Number.MAX_SAFE_INTEGER){P();const a=BigInt(r);o.valueBigInt=a}else if(o.valueDec=parseInt(r,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,n=!0),this.value.push(o)}while(i!==-1)}toString(){let e="",t=!1;for(let i=0;i<this.value.length;i++){t=this.value[i].isHexOnly;let r=this.value[i].toString();i!==0&&(e=`${e}.`),t?(r=`{${r}}`,this.value[i].isFirstSid?e=`2.{${r} - 80}`:e+=r):e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}at.NAME="ObjectIdentifierValueBlock";var ct;class ae extends k{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,at),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ct=ae;f.ObjectIdentifier=ct;ae.NAME="OBJECT IDENTIFIER";class Se extends U(D){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,i){if(i===0)return t;const r=g.toUint8Array(e);if(!I(this,r,t,i))return-1;const n=r.subarray(t,t+i);this.valueHexView=new Uint8Array(i);for(let a=0;a<i&&(this.valueHexView[a]=n[a]&127,this.blockLength++,(n[a]&128)!==0);a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,(n[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=$(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const r=this.valueHexView,n=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)n[o]=r[o]|128;return n[this.blockLength-1]=r[this.blockLength-1],n.buffer}const t=F(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",E;const i=new Uint8Array(t.byteLength);if(!e){const r=new Uint8Array(t),n=t.byteLength-1;for(let o=0;o<n;o++)i[o]=r[o]|128;i[n]=r[n]}return i.buffer}toString(){let e="";return this.isHexOnly?e=B.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Se.NAME="relativeSidBlock";class ut extends m{constructor({value:e=b,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,i){let r=t;for(;i>0;){const n=new Se;if(r=n.fromBER(e,r,i),r===-1)return this.blockLength=0,this.error=n.error,r;this.blockLength+=n.blockLength,i-=n.blockLength,this.value.push(n)}return r}toBER(e,t){const i=[];for(let r=0;r<this.value.length;r++){const n=this.value[r].toBER(e);if(n.byteLength===0)return this.error=this.value[r].error,E;i.push(n)}return Ne(i)}fromString(e){this.value=[];let t=0,i=0,r="";do{i=e.indexOf(".",t),i===-1?r=e.substring(t):r=e.substring(t,i),t=i+1;const n=new Se;if(n.valueDec=parseInt(r,10),isNaN(n.valueDec))return!0;this.value.push(n)}while(i!==-1);return!0}toString(){let e="",t=!1;for(let i=0;i<this.value.length;i++){t=this.value[i].isHexOnly;let r=this.value[i].toString();i!==0&&(e=`${e}.`),t&&(r=`{${r}}`),e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}ut.NAME="RelativeObjectIdentifierValueBlock";var ft;class Ie extends k{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,ut),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}ft=Ie;f.RelativeObjectIdentifier=ft;Ie.NAME="RelativeObjectIdentifier";var ht;class j extends S{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}ht=j;f.Sequence=ht;j.NAME="SEQUENCE";var gt;class G extends S{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}gt=G;f.Set=gt;G.NAME="SET";class dt extends U(m){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=b}toJSON(){return{...super.toJSON(),value:this.value}}}dt.NAME="StringValueBlock";class vt extends dt{}vt.NAME="SimpleStringValueBlock";class x extends Ee{constructor({...e}={}){super(e,vt)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,g.toUint8Array(e))}fromString(e){const t=e.length,i=this.valueBlock.valueHexView=new Uint8Array(t);for(let r=0;r<t;r++)i[r]=e.charCodeAt(r);this.valueBlock.value=e}}x.NAME="SIMPLE STRING";class Bt extends x{fromBuffer(e){this.valueBlock.valueHexView=g.toUint8Array(e);try{this.valueBlock.value=B.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=B.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(B.FromUtf8String(e)),this.valueBlock.value=e}}Bt.NAME="Utf8StringValueBlock";var wt;class H extends Bt{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}wt=H;f.Utf8String=wt;H.NAME="UTF8String";class kt extends x{fromBuffer(e){this.valueBlock.value=B.ToUtf16String(e),this.valueBlock.valueHexView=g.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(B.FromUtf16String(e))}}kt.NAME="BmpStringValueBlock";var mt;class ce extends kt{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}mt=ce;f.BmpString=mt;ce.NAME="BMPString";class bt extends x{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),i=new Uint8Array(t);for(let r=0;r<i.length;r+=4)i[r]=i[r+3],i[r+1]=i[r+2],i[r+2]=0,i[r+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,i=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let r=0;r<t;r++){const n=F(e.charCodeAt(r),8),o=new Uint8Array(n);if(o.length>4)continue;const a=4-o.length;for(let l=o.length-1;l>=0;l--)i[r*4+l+a]=o[l]}this.valueBlock.value=e}}bt.NAME="UniversalStringValueBlock";var yt;class ue extends bt{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}yt=ue;f.UniversalString=yt;ue.NAME="UniversalString";var At;class fe extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}At=fe;f.NumericString=At;fe.NAME="NumericString";var xt;class he extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}xt=he;f.PrintableString=xt;he.NAME="PrintableString";var St;class ge extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}St=ge;f.TeletexString=St;ge.NAME="TeletexString";var Nt;class de extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Nt=de;f.VideotexString=Nt;de.NAME="VideotexString";var Et;class ve extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}Et=ve;f.IA5String=Et;ve.NAME="IA5String";var Vt;class Be extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}Vt=Be;f.GraphicString=Vt;Be.NAME="GraphicString";var Ct;class X extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}Ct=X;f.VisibleString=Ct;X.NAME="VisibleString";var Ut;class we extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Ut=we;f.GeneralString=Ut;we.NAME="GeneralString";var It;class ke extends x{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}It=ke;f.CharacterString=It;ke.NAME="CharacterString";var Ht;class Q extends X{constructor({value:e,valueDate:t,...i}={}){if(super(i),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let r=0;r<e.length;r++)this.valueBlock.valueHexView[r]=e.charCodeAt(r)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,g.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),i=new Uint8Array(t);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const i=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(i===null){this.error="Wrong input string for conversion";return}const r=parseInt(i[1],10);r>=50?this.year=1900+r:this.year=2e3+r,this.month=parseInt(i[2],10),this.day=parseInt(i[3],10),this.hour=parseInt(i[4],10),this.minute=parseInt(i[5],10),this.second=parseInt(i[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=A(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=A(this.month,2),t[2]=A(this.day,2),t[3]=A(this.hour,2),t[4]=A(this.minute,2),t[5]=A(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Ht=Q;f.UTCTime=Ht;Q.NAME="UTCTime";var Lt;class me extends Q{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,i="",r="",n=0,o,a=0,l=0;if(e[e.length-1]==="Z")i=e.substring(0,e.length-1),t=!0;else{const u=new Number(e[e.length-1]);if(isNaN(u.valueOf()))throw new Error("Wrong input string for conversion");i=e}if(t){if(i.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(i.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let u=1,v=i.indexOf("+"),w="";if(v===-1&&(v=i.indexOf("-"),u=-1),v!==-1){if(w=i.substring(v+1),i=i.substring(0,v),w.length!==2&&w.length!==4)throw new Error("Wrong input string for conversion");let y=parseInt(w.substring(0,2),10);if(isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");if(a=u*y,w.length===4){if(y=parseInt(w.substring(2,4),10),isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");l=u*y}}}let c=i.indexOf(".");if(c===-1&&(c=i.indexOf(",")),c!==-1){const u=new Number(`0${i.substring(c)}`);if(isNaN(u.valueOf()))throw new Error("Wrong input string for conversion");n=u.valueOf(),r=i.substring(0,c)}else r=i;switch(!0){case r.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,c!==-1)throw new Error("Wrong input string for conversion");break;case r.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,c!==-1){let u=60*n;this.minute=Math.floor(u),u=60*(u-this.minute),this.second=Math.floor(u),u=1e3*(u-this.second),this.millisecond=Math.floor(u)}break;case r.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,c!==-1){let u=60*n;this.second=Math.floor(u),u=1e3*(u-this.second),this.millisecond=Math.floor(u)}break;case r.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,c!==-1){const u=1e3*n;this.millisecond=Math.floor(u)}break;default:throw new Error("Wrong input string for conversion")}const h=o.exec(r);if(h===null)throw new Error("Wrong input string for conversion");for(let u=1;u<h.length;u++)switch(u){case 1:this.year=parseInt(h[u],10);break;case 2:this.month=parseInt(h[u],10);break;case 3:this.day=parseInt(h[u],10);break;case 4:this.hour=parseInt(h[u],10)+a;break;case 5:this.minute=parseInt(h[u],10)+l;break;case 6:this.second=parseInt(h[u],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const u=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=u.getUTCFullYear(),this.month=u.getUTCMonth(),this.day=u.getUTCDay(),this.hour=u.getUTCHours(),this.minute=u.getUTCMinutes(),this.second=u.getUTCSeconds(),this.millisecond=u.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(A(this.year,4)),t.push(A(this.month,2)),t.push(A(this.day,2)),t.push(A(this.hour,2)),t.push(A(this.minute,2)),t.push(A(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(A(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}Lt=me;f.GeneralizedTime=Lt;me.NAME="GeneralizedTime";var Ot;class He extends H{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}Ot=He;f.DATE=Ot;He.NAME="DATE";var Rt;class Le extends H{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Rt=Le;f.TimeOfDay=Rt;Le.NAME="TimeOfDay";var Tt;class Oe extends H{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}Tt=Oe;f.DateTime=Tt;Oe.NAME="DateTime";var Mt;class Re extends H{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}Mt=Re;f.Duration=Mt;Re.NAME="Duration";var Ft;class Te extends H{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}Ft=Te;f.TIME=Ft;Te.NAME="TIME";class _{constructor({name:e=b,optional:t=!1}={}){this.name=e,this.optional=t}}class Me extends _{constructor({value:e=[],...t}={}){super(t),this.value=e}}class ee extends _{constructor({value:e=new _,local:t=!1,...i}={}){super(i),this.value=e,this.local=t}}class or{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=g.toUint8Array(e)}constructor({data:e=re}={}){this.dataView=g.toUint8Array(e)}fromBER(e,t,i){const r=t+i;return this.dataView=g.toUint8Array(e).subarray(t,r),r}toBER(e){return this.dataView.slice().buffer}}function T(s,e,t){if(t instanceof Me){for(const n of t.value)if(T(s,e,n).verified)return{verified:!0,result:s};{const n={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(ye)&&(n.name=t.name),n}}if(t instanceof _)return t.hasOwnProperty(ye)&&(s[t.name]=e),{verified:!0,result:s};if(!(s instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(Yt in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(Pt in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(er in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const i=t.idBlock.toBER(!1);if(i.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(i,0,i.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(Xt)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:s};if(t.idBlock.hasOwnProperty(Qt)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:s};if(t.idBlock.hasOwnProperty(Kt)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:s};if(!(zt in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:s};if(t.idBlock.isHexOnly){if(!($e in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(n.length!==o.length)return{verified:!1,result:s};for(let a=0;a<n.length;a++)if(n[a]!==o[1])return{verified:!1,result:s}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,b),t.name&&(s[t.name]=e)),t instanceof f.Constructed){let n=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof ee&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:s};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let l=!0;for(let c=0;c<t.valueBlock.value.length;c++)l=l&&(t.valueBlock.value[c].optional||!1);return l?{verified:!0,result:s}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,b),t.name&&delete s[t.name]),s.error="Inconsistent object length",{verified:!1,result:s})}for(let l=0;l<a;l++)if(l-n>=e.valueBlock.value.length){if(t.valueBlock.value[l].optional===!1){const c={verified:!1,result:s};return s.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,b),t.name&&(delete s[t.name],c.name=t.name)),c}}else if(t.valueBlock.value[0]instanceof ee){if(o=T(s,e.valueBlock.value[l],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)n++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,b),t.name&&delete s[t.name]),o;if(ye in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let c={};tr in t.valueBlock.value[0]&&t.valueBlock.value[0].local?c=e:c=s,typeof c[t.valueBlock.value[0].name]>"u"&&(c[t.valueBlock.value[0].name]=[]),c[t.valueBlock.value[0].name].push(e.valueBlock.value[l])}}else if(o=T(s,e.valueBlock.value[l-n],t.valueBlock.value[l]),o.verified===!1)if(t.valueBlock.value[l].optional)n++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,b),t.name&&delete s[t.name]),o;if(o.verified===!1){const l={verified:!1,result:s};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,b),t.name&&(delete s[t.name],l.name=t.name)),l}return{verified:!0,result:s}}if(t.primitiveSchema&&$e in e.valueBlock){const n=J(e.valueBlock.valueHexView);if(n.offset===-1){const o={verified:!1,result:n.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,b),t.name&&(delete s[t.name],o.name=t.name)),o}return T(s,n.result,t.primitiveSchema)}return{verified:!0,result:s}}function lr(s,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=J(g.toUint8Array(s));return t.offset===-1?{verified:!1,result:t.result}:T(t.result,t.result,e)}const _t=Object.freeze(Object.defineProperty({__proto__:null,Any:_,BaseBlock:k,BaseStringBlock:Ee,BitString:oe,BmpString:ce,Boolean:se,CharacterString:ke,Choice:Me,Constructed:S,DATE:He,DateTime:Oe,Duration:Re,EndOfContent:Ve,Enumerated:le,GeneralString:we,GeneralizedTime:me,GraphicString:Be,HexBlock:U,IA5String:ve,Integer:Y,Null:p,NumericString:fe,ObjectIdentifier:ae,OctetString:ne,Primitive:ie,PrintableString:he,RawData:or,RelativeObjectIdentifier:Ie,Repeated:ee,Sequence:j,Set:G,TIME:Te,TeletexString:ge,TimeOfDay:Le,UTCTime:Q,UniversalString:ue,Utf8String:H,ValueBlock:m,VideotexString:de,ViewWriter:te,VisibleString:X,compareSchema:T,fromBER:Z,verifySchema:lr},Symbol.toStringTag,{value:"Module"}));var O;(function(s){s[s.Sequence=0]="Sequence",s[s.Set=1]="Set",s[s.Choice=2]="Choice"})(O||(O={}));var d;(function(s){s[s.Any=1]="Any",s[s.Boolean=2]="Boolean",s[s.OctetString=3]="OctetString",s[s.BitString=4]="BitString",s[s.Integer=5]="Integer",s[s.Enumerated=6]="Enumerated",s[s.ObjectIdentifier=7]="ObjectIdentifier",s[s.Utf8String=8]="Utf8String",s[s.BmpString=9]="BmpString",s[s.UniversalString=10]="UniversalString",s[s.NumericString=11]="NumericString",s[s.PrintableString=12]="PrintableString",s[s.TeletexString=13]="TeletexString",s[s.VideotexString=14]="VideotexString",s[s.IA5String=15]="IA5String",s[s.GraphicString=16]="GraphicString",s[s.VisibleString=17]="VisibleString",s[s.GeneralString=18]="GeneralString",s[s.CharacterString=19]="CharacterString",s[s.UTCTime=20]="UTCTime",s[s.GeneralizedTime=21]="GeneralizedTime",s[s.DATE=22]="DATE",s[s.TimeOfDay=23]="TimeOfDay",s[s.DateTime=24]="DateTime",s[s.Duration=25]="Duration",s[s.TIME=26]="TIME",s[s.Null=27]="Null"})(d||(d={}));const ar={fromASN:s=>s instanceof p?null:s.valueBeforeDecodeView,toASN:s=>{if(s===null)return new p;const e=Z(s);if(e.result.error)throw new Error(e.result.error);return e.result}},cr={fromASN:s=>s.valueBlock.valueHexView.byteLength>=4?s.valueBlock.toString():s.valueBlock.valueDec,toASN:s=>new Y({value:+s})},ur={fromASN:s=>s.valueBlock.valueDec,toASN:s=>new le({value:s})},fr={fromASN:s=>s.valueBlock.valueHexView,toASN:s=>new oe({valueHex:s})},hr={fromASN:s=>s.valueBlock.toString(),toASN:s=>new ae({value:s})},gr={fromASN:s=>s.valueBlock.value,toASN:s=>new se({value:s})},dr={fromASN:s=>s.valueBlock.valueHexView,toASN:s=>new ne({valueHex:s})};function N(s){return{fromASN:e=>e.valueBlock.value,toASN:e=>new s({value:e})}}const vr=N(H),Br=N(ce),wr=N(ue),kr=N(fe),mr=N(he),br=N(ge),yr=N(de),Ar=N(ve),xr=N(Be),Sr=N(X),Nr=N(we),Er=N(ke),Vr={fromASN:s=>s.toDate(),toASN:s=>new Q({valueDate:s})},Cr={fromASN:s=>s.toDate(),toASN:s=>new me({valueDate:s})},Ur={fromASN:()=>null,toASN:()=>new p};function Dt(s){switch(s){case d.Any:return ar;case d.BitString:return fr;case d.BmpString:return Br;case d.Boolean:return gr;case d.CharacterString:return Er;case d.Enumerated:return ur;case d.GeneralString:return Nr;case d.GeneralizedTime:return Cr;case d.GraphicString:return xr;case d.IA5String:return Ar;case d.Integer:return cr;case d.Null:return Ur;case d.NumericString:return kr;case d.ObjectIdentifier:return hr;case d.OctetString:return dr;case d.PrintableString:return mr;case d.TeletexString:return br;case d.UTCTime:return Vr;case d.UniversalString:return wr;case d.Utf8String:return vr;case d.VideotexString:return yr;case d.VisibleString:return Sr;default:return null}}function M(s){return typeof s=="function"&&s.prototype?s.prototype.toASN&&s.prototype.fromASN?!0:M(s.prototype):!!(s&&typeof s=="object"&&"toASN"in s&&"fromASN"in s)}function $t(s){var e;if(s){const t=Object.getPrototypeOf(s);return((e=t==null?void 0:t.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:$t(t)}return!1}class Ir{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const i=this.items.get(e);if(!i)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!i.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return i}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:O.Sequence,items:{}},i=this.findParentSchema(e);return i&&(Object.assign(t,i),t.items=Object.assign({},t.items,i.items)),t}create(e,t){const i=this.items.get(e)||this.createDefault(e),r=[];for(const n in i.items){const o=i.items[n],a=t?n:"";let l;if(typeof o.type=="number"){const h=d[o.type],u=_t[h];if(!u)throw new Error(`Cannot get ASN1 class by name '${h}'`);l=new u({name:a})}else M(o.type)?l=new o.type().toSchema(a):o.optional?this.get(o.type).type===O.Choice?l=new _({name:a}):(l=this.create(o.type,!1),l.name=a):l=new _({name:a});const c=!!o.optional||o.defaultValue!==void 0;if(o.repeated){l.name="";const h=o.repeated==="set"?G:j;l=new h({name:"",value:[new ee({name:a,value:l})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||M(o.type)){const h=o.repeated?S:ie;r.push(new h({name:a,optional:c,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const h=!!o.repeated;let u=h?l:this.get(o.type,!0).schema;u="valueBlock"in u?u.valueBlock.value:u.value,r.push(new S({name:h?"":a,optional:c,idBlock:{tagClass:3,tagNumber:o.context},value:u}))}else r.push(new S({optional:c,idBlock:{tagClass:3,tagNumber:o.context},value:[l]}));else l.optional=c,r.push(l)}switch(i.type){case O.Sequence:return new j({value:r,name:""});case O.Set:return new G({value:r,name:""});case O.Choice:return new Me({value:r,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const C=new Ir,Tr=s=>e=>{let t;C.has(e)?t=C.get(e):(t=C.createDefault(e),C.set(e,t)),Object.assign(t,s)},Mr=s=>(e,t)=>{let i;C.has(e.constructor)?i=C.get(e.constructor):(i=C.createDefault(e.constructor),C.set(e.constructor,i));const r=Object.assign({},s);if(typeof r.type=="number"&&!r.converter){const n=Dt(s.type);if(!n)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);r.converter=n}i.items[t]=r};class je extends Error{constructor(){super(...arguments),this.schemas=[]}}class Fr{static parse(e,t){const i=Z(e);if(i.result.error)throw new Error(i.result.error);return this.fromASN(i.result,t)}static fromASN(e,t){var i;try{if(M(t))return new t().fromASN(e);const r=C.get(t);C.cache(t);let n=r.schema;if(e.constructor===S&&r.type!==O.Choice){n=new S({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:r.schema.valueBlock.value});for(const l in r.items)delete e[l]}const o=T({},e,n);if(!o.verified)throw new je(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if($t(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const l=r.itemType;if(typeof l=="number"){const c=Dt(l);if(!c)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,h=>c.fromASN(h))}else return t.from(e.valueBlock.value,c=>this.fromASN(c,l))}for(const l in r.items){const c=o.result[l];if(!c)continue;const h=r.items[l],u=h.type;if(typeof u=="number"||M(u)){const v=(i=h.converter)!==null&&i!==void 0?i:M(u)?new u:null;if(!v)throw new Error("Converter is empty");if(h.repeated)if(h.implicit){const w=h.repeated==="sequence"?j:G,y=new w;y.valueBlock=c.valueBlock;const L=Z(y.toBER(!1));if(L.offset===-1)throw new Error(`Cannot parse the child item. ${L.result.error}`);if(!("value"in L.result.valueBlock&&Array.isArray(L.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const K=L.result.valueBlock.value;a[l]=Array.from(K,pt=>v.fromASN(pt))}else a[l]=Array.from(c,w=>v.fromASN(w));else{let w=c;if(h.implicit){let y;if(M(u))y=new u().toSchema("");else{const L=d[u],K=_t[L];if(!K)throw new Error(`Cannot get '${L}' class from asn1js module`);y=new K}y.valueBlock=w.valueBlock,w=Z(y.toBER(!1)).result}a[l]=v.fromASN(w)}}else if(h.repeated){if(!Array.isArray(c))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[l]=Array.from(c,v=>this.fromASN(v,u))}else a[l]=this.fromASN(c,u)}return a}catch(r){throw r instanceof je&&r.schemas.push(t.name),r}}}export{ar as AsnAnyConverter,fr as AsnBitStringConverter,Br as AsnBmpStringConverter,gr as AsnBooleanConverter,Er as AsnCharacterStringConverter,ur as AsnEnumeratedConverter,Nr as AsnGeneralStringConverter,Cr as AsnGeneralizedTimeConverter,xr as AsnGraphicStringConverter,Ar as AsnIA5StringConverter,cr as AsnIntegerConverter,Ur as AsnNullConverter,kr as AsnNumericStringConverter,hr as AsnObjectIdentifierConverter,dr as AsnOctetStringConverter,Fr as AsnParser,mr as AsnPrintableStringConverter,Mr as AsnProp,d as AsnPropTypes,je as AsnSchemaValidationError,br as AsnTeletexStringConverter,Tr as AsnType,O as AsnTypeTypes,Vr as AsnUTCTimeConverter,wr as AsnUniversalStringConverter,vr as AsnUtf8StringConverter,yr as AsnVideotexStringConverter,Sr as AsnVisibleStringConverter,Dt as defaultConverter};
